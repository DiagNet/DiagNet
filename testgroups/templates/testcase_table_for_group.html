{% load i18n %}
<div class="table-responsive" id="testcases-{{ testgroup_name }}">
  {% load datetime_helpers %}
	<table class="table table-hover">
		<thead>
			<tr>
				<th></th>
				<th>{% trans "Name" %}</th>
				<th>{% trans "Test Case" %}</th>
				<th>{% trans "Last Run" %}</th>
				<th>{% trans "Status" %}</th>
			</tr>
		</thead>
		<tbody>
			{% if testcase_list %}
			{% for testcase in testcase_list %}
			<tr class="testcase-tr" id="testcase-{{ testcase.id }}">
				<td>
					<button
            hx-get="{% url 'testgroup-testcase-run' testgroup_name testcase.id %}"
            hx-target="#status-{{ testcase.id }}"
            hx-swap="outerHTML"
            class="btn btn-sm btn-primary {{ testgroup_name }}-runner"
            title="{% trans 'Run test case' %}">
						<i class="bi bi-play-fill"></i>
					</button>
				</td>

				<td>{{ testcase.label }}</td>
				<td>{{ testcase.test_module }}</td>

        <div id="run-status-{{ testcase.id }}">
          <td
            id="last-run-{{ testcase.id }}"
            title="{{ testcase.results.last.finished_at|date:'Y-m-d H:i' }}">
            {{ testcase.results.last.finished_at|relative_or_absolute }}
          </td>

          <td id="status-{{ testcase.id }}">
            {% if testcase.results.last %}
              {% if testcase.expected_result == testcase.results.last.result %}
              <span class="badge rounded-pill bg-success" aria-label="{% trans 'Success' %}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              {% else %}
              <span class="badge rounded-pill bg-danger" aria-label="{% trans 'Failure' %}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
              {% endif %}
            {% else %}
              <span class="badge rounded-pill bg-secondary" aria-label="{% trans 'Not run yet' %}">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
            {% endif %}
          </td>
        </div>

        <td class="text-end">
          <button
            hx-vals='{"testgroup": "{{ testgroup_name }}", "testcase": "{{ testcase.label }}"}'
            hx-post="{% url 'testcase-remove' %}"
            hx-target="#td-coll-{{ testgroup_name }}"
            hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
            class="btn btn-sm btn-danger"
            title="{% trans 'Remove from group' %}">
            <i class="bi bi-x"></i>
          </button>
        </td>
			</tr>
			{% endfor %}
			{% else %}
			<tr>
				<td colspan="5">{% trans "No Test Cases yet." %}</td>
			</tr>
			{% endif %}
		</tbody>
	</table>
</div>
