{% load datetime_helpers %}
<div class="table-responsive">
    <table class="table table-hover">
        <thead>
            <tr>
                <th>Name</th>
                <th>Test Case</th>
                <th>Last Run</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% if testcase_list %}
                {% for testcase in testcase_list %}
                    <tr id="testcase-{{ testcase.id }}">
                        <td class="align-middle">
                            <button type="button"
                                    class="btn btn-link"
                                    data-bs-toggle="modal"
                                    data-bs-target="#testcaseDetailModal-{{ testcase.id }}">
                                {{ testcase.label }}
                            </button>
                            <div class="modal fade"
                                 id="testcaseDetailModal-{{ testcase.id }}"
                                 tabindex="-1">
                                <div class="modal-dialog modal-lg">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button"
                                                    class="btn-close"
                                                    data-bs-dismiss="modal"
                                                    aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body"
                                             id="modal-body-{{ testcase.id }}"
                                             hx-get="{% url 'testcase-details' testcase.id %}"
                                             hx-trigger="shown.bs.modal from:closest .modal once">
                                            <div class="text-center py-5">
                                                <div class="spinner-border text-primary" role="status"></div>
                                            </div>
                                        </div>
                                        <div class="modal-footer">
                                            {% if perms.networktests.delete_testcase %}
                                                <button type="button"
                                                        class="btn btn-danger"
                                                        hx-delete="{% url 'testcase_delete' testcase.id %}"
                                                        hx-headers='{"X-CSRFToken": "{{ csrf_token }}"}'
                                                        hx-confirm="Are you sure you want to delete this test case?"
                                                        hx-trigger="click"
                                                        hx-on:click="htmx.trigger('#networktests-table', 'refresh')"
                                                        data-bs-dismiss="modal">
                                                    <i class="bi bi-trash"></i> Delete
                                                </button>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td class="align-middle">{{ testcase.test_module }}</td>
                        <td class="align-middle"
                            title="{{ testcase.results.last.finished_at|date:'Y-m-d H:i' }}">
                            {{ testcase.results.last.finished_at|relative_or_absolute }}
                        </td>
                        <td class="align-middle">
                            {% if testcase.results.last %}
                                {% if testcase.expected_result == testcase.results.last.result %}
                                    <span class="badge rounded-pill bg-success">Pass</span>
                                {% else %}
                                    <span class="badge rounded-pill bg-danger">Fail</span>
                                {% endif %}
                            {% else %}
                                <span class="badge rounded-pill bg-secondary">Unknown</span>
                            {% endif %}
                        </td>
                        <td class="align-middle">
                            {% if perms.networktests.add_testresult %}
                                <form action="{% url 'tests-run' testcase.id %}"
                                      method="post"
                                      class="d-inline">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-sm btn-primary" title="Run test case">
                                        <i class="bi bi-play-fill"></i>
                                    </button>
                                </form>
                            {% endif %}
                        </td>
                    </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td class="align-middle" colspan="5">No Test Cases yet.</td>
                </tr>
            {% endif %}
        </tbody>
    </table>
</div>
